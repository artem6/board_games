(this.webpackJsonpboardgames=this.webpackJsonpboardgames||[]).push([[0],{17:function(e,n,t){},19:function(e,n,t){},20:function(e,n,t){"use strict";t.r(n);var r=t(3),c=t(2),s=t.n(c),a=t(8),o=t.n(a),i=(t(17),t(0)),u=t.n(i),b=t(7),d=t(1),l=(t(19),t(10)),p=t(11),h=t(9),f={prod:{API_HOST:"https://artemboardgames.herokuapp.com/",WS_HOST:"wss://artemboardgames.herokuapp.com/ws"},test:{API_HOST:"https://artemboardgames.herokuapp.com/",WS_HOST:"wss://artemboardgames.herokuapp.com/ws"},dev:{API_HOST:"http://localhost:5000/",WS_HOST:"ws://localhost:5000/ws"}},m=function(e){return f.prod[e]},v=t(22).a,g=36e5;var O=new function e(n){var t=this;Object(h.a)(this,e),this.connection=null,this.connectionPending=null,this.subscriptions=[],this.pendingSubscriptions=[],this.connectionDelay=0,this.serverUrl="",this.authInterval=3e5,this.heartbeatInterval=3e4,this.lastHeartbeat=0,this.missedHeartbeats=0,this.increaseConnDelay=function(){t.connectionDelay*=2,t.connectionDelay>g&&(t.connectionDelay=g),t.connectionDelay<500&&(t.connectionDelay=500),t.connectionDelay},this.decreaseConnDelay=function(){t.connectionDelay>500?t.connectionDelay/=2:t.connectionDelay=0,t.connectionDelay},this.onError=function(e){console.error(e)},this.onClose=Object(d.a)(u.a.mark((function e(){var n,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.increaseConnDelay(),t.disconnect(),(n=t.pendingSubscriptions).push.apply(n,Object(p.a)(t.subscriptions)),t.subscriptions=[],r=[];case 6:if(!t.pendingSubscriptions.length){e.next=13;break}if(c=t.pendingSubscriptions.shift()){e.next=10;break}return e.abrupt("continue",6);case 10:r.push(t.subscribe(c.event,c.callback,c.id)),e.next=6;break;case 13:return e.next=15,Promise.all(r);case 15:case 16:case"end":return e.stop()}}),e)}))),this.onMessage=function(e){var n;if(t.lastHeartbeat=Date.now(),"PING"!==e.data){if("PONG"!==e.data)try{var r=JSON.parse(e.data),c=t.subscriptions.find((function(e){return e.id===r.id}));if(!c)return void console.error("No subscription found to listen to: ".concat(e.data));c.callback(r.message),"UNSUBSCRIBE"===r.type&&t.unsubscribe(c.event)}catch(s){console.error("Invalid Message from Server")}}else null===(n=t.connection)||void 0===n||n.send("PONG")},this.disconnect=function(){var e=t.connection;e&&e.OPEN&&e.close(),t.connectionPending=null,t.connection=null},this.connectionTimeout=null,this.connect=Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.connection||t.connectionPending){e.next=2;break}return e.abrupt("return");case 2:if(!t.connectionPending){e.next=6;break}return e.next=5,t.connectionPending;case 5:return e.abrupt("return");case 6:clearTimeout(t.connectionTimeout),t.connectionPending=new Promise(function(){var e=Object(d.a)(u.a.mark((function e(n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.connectionDelay,e.next=3,new Promise((function(e){return setTimeout(e,t.connectionDelay)}));case 3:t.connectionDelay,t.connection=new WebSocket(t.serverUrl),t.connection.addEventListener("error",t.onError),t.connection.addEventListener("close",t.onClose),t.connection.addEventListener("message",t.onMessage),r=!1,t.connection.addEventListener("open",(function(){r||(clearTimeout(t.connectionTimeout),t.connectionPending=null,r=!0,t.sendHeartbeat(),t.sendAuth(),n())})),t.connectionTimeout=setTimeout(Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=2;break}return e.abrupt("return");case 2:return e.next=5,t.onClose();case 5:return e.next=7,t.connect();case 7:n();case 8:case"end":return e.stop()}}),e)}))),1e4);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 9:if(!t.connectionPending){e.next=14;break}return e.next=12,t.connectionPending;case 12:e.next=9;break;case 14:null===(n=t.connection)||void 0===n||n.OPEN;case 15:case"end":return e.stop()}}),e)}))),this.subscribe=function(){var e=Object(d.a)(u.a.mark((function e(n,r){var c,s,a=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=a.length>2&&void 0!==a[2]?a[2]:v(),e.next=3,t.connect();case 3:if(!t.subscriptions.find((function(e){return e.event===n}))){e.next=6;break}throw new Error("Already subscribed to ".concat(n));case 6:return s={id:c,callback:r,event:n},t.subscriptions.push(s),e.next=10,t.sendMessage({id:s.id,type:"SUBSCRIBE",message:{event:n}});case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),this.unsubscribe=function(){var e=Object(d.a)(u.a.mark((function e(n){var r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.subscriptions.length){e.next=3;break}throw new Error("No active subscriptions: "+n);case 3:if(r=t.subscriptions.find((function(e){return e.event===n}))){e.next=6;break}return e.abrupt("return");case 6:if(c=t.subscriptions.indexOf(r),r&&-1!==c){e.next=9;break}throw new Error("Not subscribed to ".concat(n));case 9:return t.subscriptions.splice(c,1),e.next=12,t.sendMessage({id:r.id,type:"UNSUBSCRIBE",message:{event:r.event}});case 12:0===t.subscriptions.length&&t.disconnect();case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.sendMessage=function(){var e=Object(d.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.message,e.next=3,t.connect();case 3:n.message,t.connection&&t.connection.OPEN?t.connection.send(JSON.stringify(n)):setTimeout((function(){return t.sendMessage(n)}),5e3);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),this.sendAuthTimeout=null,this.sendAuth=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.authInterval<=0)){e.next=2;break}return e.abrupt("return");case 2:clearTimeout(t.sendAuthTimeout),"",t.sendMessage({id:null,type:"AUTHORIZATION",message:{token:""}}),t.sendAuthTimeout=setTimeout(t.sendAuth,t.authInterval);case 6:case"end":return e.stop()}}),e)}))),this.heartbeatTimeout=null,this.sendHeartbeat=function(){if(clearTimeout(t.heartbeatTimeout),t.connection&&!t.connectionPending&&t.connection.OPEN&&!(t.heartbeatInterval<=0)){var e=t.lastHeartbeat+t.heartbeatInterval-Date.now();if(-1*e>2*t.heartbeatInterval?t.missedHeartbeats++:(t.missedHeartbeats=0,t.decreaseConnDelay()),e>0)t.heartbeatTimeout=setTimeout(t.sendHeartbeat,e);else{if(t.missedHeartbeats>2)return t.missedHeartbeats=0,void t.onClose();t.connection.send("PING"),t.heartbeatTimeout=setTimeout(t.sendHeartbeat,t.heartbeatInterval)}}},this.serverUrl=n}(m("WS_HOST"));var x=function(){var e=function(e){var n=Object(c.useState)({}),t=Object(l.a)(n,2),r=t[0],s=t[1];return Object(c.useEffect)((function(){return O.subscribe("EntityChange:".concat(e),(function(e){s(e)})),function(){O.unsubscribe("EntityChange:".concat(e))}}),[]),r}("abc");return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("button",{onClick:Object(d.a)(u.a.mark((function n(){var t;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch("".concat(m("API_HOST"),"update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(b.a)(Object(b.a)({id:"abc",version:0},e),{},{test:"xyz"}))});case 2:return t=n.sent,n.next=5,t.json();case 5:n.sent;case 6:case"end":return n.stop()}}),n)}))),children:"add"}),Object(r.jsx)("pre",{children:JSON.stringify(e,null,4)})]})},w=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,23)).then((function(n){var t=n.getCLS,r=n.getFID,c=n.getFCP,s=n.getLCP,a=n.getTTFB;t(e),r(e),c(e),s(e),a(e)}))};o.a.render(Object(r.jsx)(s.a.StrictMode,{children:Object(r.jsx)(x,{})}),document.getElementById("root")),w()}},[[20,1,2]]]);
//# sourceMappingURL=main.c8972912.chunk.js.map